<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Explore • UnseenRealm</title>

<link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet">
<script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>

<style>
/* GLOBAL */
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,system-ui,sans-serif}
body{background:#0b0014;color:#fff;overflow-x:hidden}

/* NAV */
.nav{
 position:fixed;top:0;left:0;width:100%;
 padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;
 background:rgba(0,0,0,.35);backdrop-filter:blur(12px);z-index:200
}
.logo{font-size:1.6rem;font-weight:800}
.logo span{color:#ff00f5}
#navLinks a{
 color:#fff;margin-left:1rem;text-decoration:none;font-size:.95rem;position:relative
}
#navLinks a::after{
 content:"";position:absolute;left:0;bottom:-3px;width:0;height:2px;background:#ff00f5;transition:.25s
}
#navLinks a:hover::after{width:100%}

/* PAGE */
.explore-page{padding-top:7rem;max-width:1400px;margin:auto}
.explore-header{padding:2rem;display:flex;justify-content:space-between;flex-wrap:wrap}
.explore-header h1{
 font-size:2.4rem;background:linear-gradient(90deg,#ff00f5,#00e1ff);
 -webkit-background-clip:text;color:transparent
}

.pill-row{display:flex;gap:.5rem}
.pill{
 padding:.35rem .9rem;border-radius:50px;background:rgba(255,255,255,.08);
 border:1px solid rgba(255,255,255,.12);font-size:.75rem
}

/* FILTER TAGS */
.explore-controls{padding:1rem 2rem}
.chip-row{display:flex;flex-wrap:wrap;gap:.5rem}
.chip{
 padding:.45rem 1rem;border-radius:50px;background:rgba(255,255,255,.1);
 cursor:pointer;color:#fff;border:1px solid rgba(255,255,255,.18)
}
.chip-active{
 background:linear-gradient(90deg,#ff00f5,#00e1ff);
 border:none
}

/* FILTER PANEL */
.filter-btn{
 position:fixed;top:50%;right:0;transform:translateY(-50%);
 padding:1rem;background:linear-gradient(90deg,#ff00f5,#00e1ff);
 border-top-left-radius:12px;border-bottom-left-radius:12px;
 color:#fff;font-weight:600;cursor:pointer;z-index:260
}
.filter-panel{
 position:fixed;top:0;right:-330px;width:300px;height:100%;
 background:rgba(0,0,0,.75);backdrop-filter:blur(20px);
 padding:1.4rem;transition:.45s;z-index:300;
 border-left:1px solid rgba(255,255,255,.15)
}
.filter-panel.open{right:0}

.select{
 padding:.7rem 1rem;border-radius:12px;background:#000;
 border:1px solid #555;color:#fff;width:100%;margin:.5rem 0
}

/* MAP + LIST */
.explore-layout{padding:2rem;display:grid;grid-template-columns:1fr 1fr;gap:2rem}
.map-panel,.list-panel{background:rgba(255,255,255,.06);border-radius:20px;padding:1.5rem}
#map3d{width:100%;height:500px;border-radius:16px}

/* LIST CARDS */
.exp-card{
 background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);
 padding:1rem;border-radius:16px;margin-bottom:1rem;
 display:flex;justify-content:space-between;align-items:center;
 cursor:pointer;transition:.2s
}
.exp-card:hover{transform:scale(1.03)}
.exp-title{
 font-size:1.05rem;font-weight:700;
 background:linear-gradient(90deg,#ff00f5,#00e1ff);
 -webkit-background-clip:text;color:transparent
}
/* HEART BUTTON */
.like-btn{
 width:36px;height:36px;border-radius:50%;
 background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);
 display:flex;align-items:center;justify-content:center;
 cursor:pointer;transition:.2s
}
.like-btn svg{width:20px;fill:#aaa}
.like-btn.saved{background:#ff00f5}
.like-btn.saved svg{fill:#fff}

/* USER PIN */
.user-pin{
 width:28px;height:28px;border-radius:50%;
 background:linear-gradient(135deg,#ff00f5,#00e1ff);
 box-shadow:0 0 18px #ff00f5;position:relative
}
.ring{
 position:absolute;width:40px;height:40px;border-radius:50%;
 border:2px solid #ff00f5;top:50%;left:50%;
 transform:translate(-50%,-50%);opacity:.6;
 animation:ping 2s infinite ease-out
}
@keyframes ping{
 from{transform:translate(-50%,-50%) scale(.6);opacity:.7}
 to{transform:translate(-50%,-50%) scale(1.7);opacity:0}
}

/* LABELS & POPUP */
.distance-label{
 background:rgba(0,0,0,.7);padding:.3rem .6rem;border-radius:6px;font-size:.7rem;color:#fff
}
.hover-label,.info-bubble{
 position:absolute;background:linear-gradient(90deg,#ff00f5,#00e1ff);
 color:#fff;padding:.45rem .8rem;border-radius:10px;font-size:.75rem;
 opacity:0;transition:.15s;pointer-events:none;z-index:300
}
.hover-label.show,.info-bubble.show{opacity:1}

/* POPUP */
#popupOverlay{
 position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;z-index:400
}
#popupBox{
 position:fixed;bottom:40px;left:50%;transform:translateX(-50%);
 background:#0d0018;border-radius:16px;padding:1.2rem;
 width:90%;max-width:380px;border:1px solid rgba(255,255,255,.15);
 display:none;z-index:500
}
#popupTitle{
 font-size:1.25rem;font-weight:700;
 background:linear-gradient(90deg,#ff00f5,#00e1ff);
 -webkit-background-clip:text;color:transparent
}
#popupSaveBtn,#popupNavBtn{
 width:100%;padding:.75rem;border-radius:12px;
 background:linear-gradient(90deg,#ff00f5,#00e1ff);
 border:none;color:#fff;font-weight:600;margin-top:.6rem
}

@media(max-width:900px){
 .explore-layout{grid-template-columns:1fr}
 #map3d{height:380px}
}
</style>
</head>

<body>

<!-- NAV -->
<header class="nav">
  <div class="logo">Unseen<span>Realm</span></div>
  <nav id="navLinks">
    <a href="index.html">Home</a>
    <a href="profile.html">Profile</a>
    <a href="itinerary.html">Itinerary</a>
  </nav>
</header>

<!-- FILTER BUTTON -->
<div class="filter-btn" id="openFilters">FILTERS →</div>

<!-- FILTER PANEL -->
<div class="filter-panel" id="filterPanel">
  <h2>Filters</h2>

  <label>Rating</label>
  <input type="range" min="1" max="5" id="ratingFilter" value="1">
  <div id="ratingValue">★ 1+</div>

  <label style="margin-top:1rem">Distance (km)</label>
  <input type="range" min="1" max="20" id="distanceFilter" value="20">
  <div id="distanceValue">Within 20 km</div>

  <label style="margin-top:1rem">Budget</label>
  <select id="budgetFilter" class="select">
    <option value="any">Any</option>
    <option value="low">₹ Low</option>
    <option value="mid">₹₹ Medium</option>
    <option value="high">₹₹₹ High</option>
  </select>

  <label style="margin-top:1rem">Crowd</label>
  <select id="crowdFilter" class="select">
    <option value="any">Any</option>
    <option value="calm">Calm</option>
    <option value="medium">Medium</option>
    <option value="busy">Busy</option>
  </select>

  <label style="margin-top:1rem">Mood</label>
  <div>
    <span class="mood-chip active" data-mood="any" style="background:#222">Any</span>
    <span class="mood-chip chill" data-mood="chill">Chill</span>
    <span class="mood-chip social" data-mood="social">Social</span>
    <span class="mood-chip adrenaline" data-mood="adrenaline">Adrenaline</span>
    <span class="mood-chip budget" data-mood="budget">Budget</span>
  </div>

  <button class="apply-btn" id="applyFilters">Apply</button>
</div>

<!-- POPUP -->
<div id="popupOverlay"></div>
<div id="popupBox">
  <div style="display:flex;align-items:center;gap:10px">
    <div id="popupTitle"></div>
    <div id="popupClose" style="cursor:pointer;font-size:1.3rem">×</div>
  </div>

  <p id="popupSub"></p>

  <button id="popupSaveBtn">Save to Itinerary</button>
  <button id="popupNavBtn">Open in Google Maps</button>
</div>

<!-- MAIN PAGE CONTENT -->
<main class="explore-page">

  <section class="explore-header">
    <div>
      <h1>Explore Vizag Experiences</h1>
      <p style="color:#ccc;font-size:.9rem">Neon-powered suggestions on a tilted satellite map.</p>
    </div>
    <div class="pill-row">
      <span class="pill">Live</span>
      <span class="pill">3D Satellite</span>
    </div>
  </section>

  <section class="explore-controls">
    <label style="font-size:.9rem">Interests</label>
    <div class="chip-row" id="interestFilters">
      <button class="chip chip-active" data-interest="all">All</button>
      <button class="chip" data-interest="food">Food</button>
      <button class="chip" data-interest="nature">Nature</button>
      <button class="chip" data-interest="nightlife">Nightlife</button>
      <button class="chip" data-interest="culture">Culture</button>
      <button class="chip" data-interest="adventure">Adventure</button>
    </div>
  </section>

  <section class="explore-layout">
    <div class="map-panel">
      <h2>Vizag Map</h2>
      <p style="color:#aaa;font-size:.8rem;margin-bottom:8px">Tilted 3D Satellite View</p>
      <div id="map3d"></div>
    </div>

    <div class="list-panel">
      <h2>Suggestions</h2>
      <p id="resultsCount" style="color:#aaa;font-size:.85rem;margin-bottom:1rem">Loading...</p>
      <div id="experienceList"></div>
    </div>
  </section>

</main>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<script>
/* FIREBASE INIT */
firebase.initializeApp({
 apiKey:"AIzaSyA7qrQeypEYFhKCvQjM-5PaMaYpTFJZ-mk",
 authDomain:"unseenrealm-b43d9.firebaseapp.com",
 projectId:"unseenrealm-b43d9"
});
const auth=firebase.auth();
const db=firebase.firestore();

/* STATE */
let currentInterest="all";
let currentMood="any";
let userLocation=[83.375183,17.7774363];

/* EXPERIENCES DATA */
const experiences=[
 {id:1,title:"Yendada Secret Viewpoint",city:"Vizag",description:"Cliff breeze, sunrise calm.",interest:"nature",mood:"chill",rating:5,budget:"low",crowd:"calm",mapX:83.3556,mapY:17.7789},
 {id:2,title:"RK Beach Night Drive",city:"Vizag",description:"Neon stalls & sea wind.",interest:"nightlife",mood:"chill",rating:4,budget:"mid",crowd:"medium",mapX:83.3161,mapY:17.7195},
 {id:3,title:"Rushikonda Hidden Steps",city:"Vizag",description:"Stone pathway viewpoint.",interest:"adventure",mood:"adrenaline",rating:5,budget:"low",crowd:"calm",mapX:83.3775,mapY:17.8583},
 {id:4,title:"Seethammadhara Food Street",city:"Vizag",description:"Local neon snacks.",interest:"food",mood:"budget",rating:4,budget:"low",crowd:"busy",mapX:83.3032,mapY:17.7435},
 {id:5,title:"Kailasagiri Ropeway Base",city:"Vizag",description:"Romantic skyline area.",interest:"culture",mood:"social",rating:5,budget:"mid",crowd:"medium",mapX:83.3451,mapY:17.7446},
 {id:6,title:"GVP Backside Cliff Spot",city:"Rushikonda",description:"Secret rocky cliff.",interest:"nature",mood:"chill",rating:5,budget:"low",crowd:"calm",mapX:83.3681,mapY:17.8185},
 {id:7,title:"GVP Hilltop Curve View",city:"Rushikonda",description:"Legendary curve view.",interest:"adventure",mood:"social",rating:4,budget:"low",crowd:"medium",mapX:83.3729,mapY:17.8224},
 {id:8,title:"GVP Canteen Lane Food",city:"Rushikonda",description:"Famous student lane.",interest:"food",mood:"budget",rating:4,budget:"low",crowd:"busy",mapX:83.3704,mapY:17.8211},
 {id:9,title:"Forest Trail Behind GVP",city:"Rushikonda",description:"Mini forest trail.",interest:"adventure",mood:"adrenaline",rating:5,budget:"free",crowd:"calm",mapX:83.3698,mapY:17.8192},
 {id:10,title:"GVP Beach Road Sitout",city:"Rushikonda",description:"Evening breeze.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"calm",mapX:83.3735,mapY:17.8199},
 {id:201,title:"Yendada Breeze Patch",city:"Vizag",description:"Right beside you.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"calm",mapX:83.37513,mapY:17.77752},
 {id:202,title:"Yendada Cliff Micro-Edge",city:"Vizag",description:"Wind corridor spot.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"calm",mapX:83.37572,mapY:17.77655},
 {id:203,title:"IT Hills Frame View",city:"Vizag",description:"Gap rooftop frame.",interest:"culture",mood:"social",rating:4,budget:"free",crowd:"medium",mapX:83.37641,mapY:17.77702},
 {id:204,title:"Curve Forest Pocket",city:"Vizag",description:"Silent forest scent.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"calm",mapX:83.37395,mapY:17.77783},
 {id:320,title:"Kasol Riverside Calm Patch",city:"Himachal",description:"Deep pine calm zone.",interest:"nature",mood:"chill",rating:5,budget:"mid",crowd:"medium",mapX:77.3210,mapY:32.0099},
 /* ---------------------- 100 EXPERIENCES NEAR GVP RUSHIKONDA (20 KM) ---------------------- */

/* ---------------------- RUSHIKONDA → CORE CLUSTER ---------------------- */
{id:700,title:"Rushikonda Sunrise Rock Shelf",city:"Rushikonda",description:"Best early morning rock platform with crashing waves.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"calm",mapX:83.38012,mapY:17.80921},
{id:701,title:"Rushikonda Cliff Bowl",city:"Rushikonda",description:"Circular cliff dip with strong wind echo.",interest:"adventure",mood:"adrenaline",rating:5,budget:"free",crowd:"medium",mapX:83.38152,mapY:17.81312},
{id:702,title:"GVP Back Gate Trail Start",city:"Rushikonda",description:"Secret forest-like trail starting behind GVP.",interest:"adventure",mood:"chill",rating:4,budget:"free",crowd:"calm",mapX:83.36912,mapY:17.81872},
{id:703,title:"GVP Rooftop Night Wind Spot",city:"Rushikonda",description:"Popular student nightly hangout for breeze.",interest:"nightlife",mood:"social",rating:4,budget:"free",crowd:"medium",mapX:83.37081,mapY:17.82092},
{id:704,title:"GVP Staff Road Sitout",city:"Rushikonda",description:"Quiet bench-style sitout area beside staff quarters.",interest:"nature",mood:"chill",rating:4,budget:"free",crowd:"low",mapX:83.36975,mapY:17.82152},
{id:705,title:"Rushikonda Hidden Coconut Patch",city:"Rushikonda",description:"Green patch with natural canopy shades.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"calm",mapX:83.37972,mapY:17.80733},
{id:706,title:"Rushikonda Sunset Curve",city:"Rushikonda",description:"Famous curve with orange-pink horizon views.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"medium",mapX:83.37741,mapY:17.81752},
{id:707,title:"GVP Boys Hostel Terrace Peak",city:"Rushikonda",description:"Panoramic city-cum-sea view.",interest:"nightlife",mood:"chill",rating:5,budget:"free",crowd:"low",mapX:83.36902,mapY:17.81988},
{id:708,title:"GVP Sports Ground Breezeline",city:"Rushikonda",description:"Perfect wind corridor after 6pm.",interest:"nature",mood:"social",rating:4,budget:"free",crowd:"medium",mapX:83.37133,mapY:17.81808},
{id:709,title:"Rushikonda Hidden Sea Steps",city:"Rushikonda",description:"Old stone formation leading close to waves.",interest:"adventure",mood:"adrenaline",rating:5,budget:"free",crowd:"low",mapX:83.37994,mapY:17.81088},

/* ---------------------- RUSHIKONDA FOOD CLUSTER ---------------------- */
{id:710,title:"Rushi Maggi Corner",city:"Rushikonda",description:"Student favourite hot Maggi spot.",interest:"food",mood:"budget",rating:4,budget:"low",crowd:"busy",mapX:83.37152,mapY:17.82142},
{id:711,title:"Rushi Beach Road Fries Shop",city:"Rushikonda",description:"Midnight fries with beach-side wind.",interest:"food",mood:"nightlife",rating:4,budget:"low",crowd:"busy",mapX:83.37282,mapY:17.82091},
{id:712,title:"Rushikonda Coconut Water Strip",city:"Rushikonda",description:"Refreshing break along shore road.",interest:"food",mood:"chill",rating:4,budget:"low",crowd:"medium",mapX:83.37452,mapY:17.81662},
{id:713,title:"GVP Campus Chai Circle",city:"Rushikonda",description:"Late-night student meet hub.",interest:"food",mood:"social",rating:4,budget:"low",crowd:"busy",mapX:83.37065,mapY:17.82288},
{id:714,title:"Mini Tiffins by GVP Turn",city:"Rushikonda",description:"Best budget idli-dosa patch.",interest:"food",mood:"budget",rating:5,budget:"low",crowd:"medium",mapX:83.37113,mapY:17.82333},

/* ---------------------- YENDADA / IT HILLS CLUSTER ---------------------- */
{id:720,title:"Yendada Top Ridge Windline",city:"Yendada",description:"Wind hits strongest at this top ridge.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"calm",mapX:83.37403,mapY:17.77962},
{id:721,title:"IT Hills Night Balcony Spot",city:"Yendada",description:"Balcony-like cliff with skyline lights.",interest:"nightlife",mood:"social",rating:5,budget:"free",crowd:"medium",mapX:83.37692,mapY:17.77721},
{id:722,title:"Yendada Secret Tunnel Lane",city:"Yendada",description:"Narrow lane between cliffs, perfect photo spot.",interest:"culture",mood:"social",rating:4,budget:"free",crowd:"low",mapX:83.37583,mapY:17.77618},
{id:723,title:"Yendada Valley Sitout",city:"Yendada",description:"Lower valley gives mountain-like feel.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"calm",mapX:83.37452,mapY:17.77803},
{id:724,title:"IT Hills Tech Adda Road",city:"Yendada",description:"Popular for night drives + coffee.",interest:"nightlife",mood:"social",rating:4,budget:"free",crowd:"medium",mapX:83.37712,mapY:17.77772},
{id:725,title:"Yendada Forest Edge",city:"Yendada",description:"End of road with lush green backdrop.",interest:"adventure",mood:"adrenaline",rating:4,budget:"free",crowd:"low",mapX:83.37392,mapY:17.78028},

/* ---------------------- SAGAR NAGAR CLUSTER ---------------------- */
{id:740,title:"Sagar Nagar Upper Cliff",city:"Vizag",description:"Lightly visited cliff with sea arc view.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"low",mapX:83.3525,mapY:17.7562},
{id:741,title:"Sagar Nagar Arch Rock",city:"Vizag",description:"Rare rock arch seen during low tide.",interest:"adventure",mood:"adrenaline",rating:5,budget:"free",crowd:"medium",mapX:83.3494,mapY:17.7531},
{id:742,title:"Sagar Nagar Sea Street",city:"Vizag",description:"Cool breeze + evening chai.",interest:"food",mood:"chill",rating:4,budget:"low",crowd:"medium",mapX:83.3534,mapY:17.7547},
{id:743,title:"Sagar Nagar Fishing Edge",city:"Vizag",description:"Quiet fishing zone at mornings.",interest:"nature",mood:"chill",rating:4,budget:"free",crowd:"low",mapX:83.3509,mapY:17.7522},

/* ---------------------- MVP COLONY CLUSTER ---------------------- */
{id:760,title:"MVP Double Road Breeze Spot",city:"Vizag",description:"Strong wind corridor, photogenic at dusk.",interest:"nature",mood:"chill",rating:4,budget:"free",crowd:"medium",mapX:83.33012,mapY:17.74431},
{id:761,title:"MVP Subway Art Steps",city:"Vizag",description:"Colourful graffiti steps.",interest:"culture",mood:"social",rating:4,budget:"free",crowd:"medium",mapX:83.32982,mapY:17.74272},
{id:762,title:"MVP Park Bench Lane",city:"Vizag",description:"Tree-lined walkway ideal for evening relaxation.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"calm",mapX:83.3321,mapY:17.7459},

/* ---------------------- TENNETI PARK CLUSTER ---------------------- */
{id:780,title:"Tenneti Cliff Descent Trail",city:"Vizag",description:"Steep hidden access down from the park.",interest:"adventure",mood:"adrenaline",rating:5,budget:"free",crowd:"medium",mapX:83.3402,mapY:17.7421},
{id:781,title:"Tenneti Sea Bench View",city:"Vizag",description:"One of the most peaceful benches facing the sea.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"low",mapX:83.3411,mapY:17.7431},

/* ---------------------- ARILOVA / ZOO AREA ---------------------- */
{id:790,title:"Arilova Temple Steps",city:"Vizag",description:"Quiet + green with stone steps.",interest:"culture",mood:"chill",rating:4,budget:"free",crowd:"calm",mapX:83.3162,mapY:17.7702},
{id:791,title:"Zoo Backroad Forest Smell Strip",city:"Vizag",description:"Strong eucalyptus scent patch.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"low",mapX:83.3175,mapY:17.7611},
{id:792,title:"Arilova Small Hilltop",city:"Vizag",description:"City skyline from a low-height hill.",interest:"adventure",mood:"adrenaline",rating:4,budget:"free",crowd:"low",mapX:83.3193,mapY:17.7639},

/* ---------------------- BHEEMILI ROAD / NEAR 20 KM ---------------------- */
{id:820,title:"Bheemili View Curve 1",city:"Vizag",description:"Empty curve overlooking long coastline.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"low",mapX:83.4251,mapY:17.8892},
{id:821,title:"Bheemili Sand Patch South",city:"Vizag",description:"Clean sand rarely visited.",interest:"nature",mood:"chill",rating:4,budget:"free",crowd:"low",mapX:83.4282,mapY:17.8851},
{id:822,title:"Bheemili Hill Step Road",city:"Vizag",description:"Steep zigzag road with top view.",interest:"adventure",mood:"adrenaline",rating:5,budget:"free",crowd:"medium",mapX:83.4221,mapY:17.8936},

/* ---------------------- EXTRA DENSE CLUSTER NEAR GVP ---------------------- */
{id:850,title:"GVP East Lane Chill Zone",city:"Rushikonda",description:"Calm quiet lane perfect for long talks.",interest:"nature",mood:"chill",rating:4,budget:"free",crowd:"low",mapX:83.37171,mapY:17.82198},
{id:851,title:"GVP North Sitout Rock",city:"Rushikonda",description:"Rock patch behind north block.",interest:"adventure",mood:"chill",rating:5,budget:"free",crowd:"low",mapX:83.37199,mapY:17.81934},
{id:852,title:"GVP Evening Walk Strip",city:"Rushikonda",description:"Popular walk lane used by students daily.",interest:"nature",mood:"social",rating:4,budget:"free",crowd:"medium",mapX:83.37023,mapY:17.82012},
{id:853,title:"GVP Secret Backbench",city:"Rushikonda",description:"Hidden bench under a neem tree.",interest:"nature",mood:"calm",rating:5,budget:"free",crowd:"low",mapX:83.37101,mapY:17.81981},
{id:854,title:"Rushi Old Lighthouse Foundation",city:"Rushikonda",description:"Broken stone base with history.",interest:"culture",mood:"chill",rating:4,budget:"free",crowd:"low",mapX:83.37851,mapY:17.80881},

/* ---------------------- UP TO 100 ENTRIES ---------------------- */
{id:855,title:"Rushikonda Sea Bridge Corner",city:"Rushikonda",description:"Secluded edge near the bridge.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"low",mapX:83.37588,mapY:17.81352},
{id:856,title:"Rushikonda College Bend Hangout",city:"Rushikonda",description:"Most-used spot by GVP students.",interest:"nightlife",mood:"social",rating:4,budget:"low",crowd:"busy",mapX:83.37271,mapY:17.82218},
{id:857,title:"Yendada West Hill Steps",city:"Yendada",description:"Small stone steps leading to a silent cliff.",interest:"adventure",mood:"chill",rating:5,budget:"free",crowd:"low",mapX:83.37202,mapY:17.77981},
{id:858,title:"Yendada Overlook Bench",city:"Yendada",description:"Single bench facing the mountain skyline.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"calm",mapX:83.37528,mapY:17.77801},
{id:859,title:"IT Hills Food Cluster Spot",city:"Yendada",description:"Paneer rolls + shawarma + live crowd.",interest:"food",mood:"nightlife",rating:5,budget:"low",crowd:"busy",mapX:83.37655,mapY:17.77759},

{id:860,title:"Rushikonda Palm Tree Stretch",city:"Rushikonda",description:"Feels like Bali. Perfect for photos.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"medium",mapX:83.38099,mapY:17.80651},
{id:861,title:"Rushikonda View Ridge Twin Peaks",city:"Rushikonda",description:"Two-peak point giving 270° panorama.",interest:"adventure",mood:"adrenaline",rating:5,budget:"free",crowd:"low",mapX:83.38277,mapY:17.81592},
{id:862,title:"Rushikonda Cove Hidden Patch",city:"Rushikonda",description:"Tiny curved cove accessible only by trail.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"low",mapX:83.38125,mapY:17.80772},

{id:863,title:"Madhurawada Metro Curve",city:"Madhurawada",description:"Brilliant night lights from metro pillars.",interest:"nightlife",mood:"social",rating:4,budget:"free",crowd:"medium",mapX:83.40011,mapY:17.82881},
{id:864,title:"Madhurawada Food Street Lite",city:"Madhurawada",description:"Budget food heaven, extremely active.",interest:"food",mood:"nightlife",rating:5,budget:"low",crowd:"busy",mapX:83.40272,mapY:17.82671},

{id:865,title:"Rushi Z-Bend High Point",city:"Rushikonda",description:"Sharp Z-bend on hill with surreal view.",interest:"adventure",mood:"adrenaline",rating:5,budget:"free",crowd:"medium",mapX:83.38111,mapY:17.81332},
{id:866,title:"GVP Hidden Forest Pocket 2",city:"Rushikonda",description:"Another secret forest-like hideout.",interest:"nature",mood:"chill",rating:4,budget:"free",crowd:"low",mapX:83.37092,mapY:17.81972},

{id:867,title:"Beach Road Milkyway Spot",city:"Vizag",description:"Dark sky patch where stars are clearer.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"low",mapX:83.33381,mapY:17.73621},
{id:868,title:"Yendada Lovers Corner Ridge",city:"Yendada",description:"Quiet and private ridge corner.",interest:"nature",mood:"social",rating:4,budget:"free",crowd:"low",mapX:83.37512,mapY:17.77742},
{id:869,title:"Rushikonda Shallow Pool Rocks",city:"Rushikonda",description:"Tide pools forming tiny natural aquariums.",interest:"nature",mood:"chill",rating:5,budget:"free",crowd:"medium",mapX:83.38052,mapY:17.80942},

{id:870,title:"Bheemili Lighthouse Base Patch",city:"Bheemili",description:"Historic lighthouse backdrop.",interest:"culture",mood:"chill",rating:5,budget:"free",crowd:"low",mapX:83.44012,mapY:17.89161},


];

/* HAVERSINE */
function hav(a,b,c,d){
 let R=6371,x=(c-a)*Math.PI/180,y=(d-b)*Math.PI/180;
 let h=Math.sin(x/2)**2 + Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(y/2)**2;
 return R*2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h));
}

/* MAP INIT */
let map3d=new maplibregl.Map({
 container:"map3d",
 style:{
  version:8,
  sources:{sat:{type:"raster",tiles:[
   "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"
  ],tileSize:256}},
  layers:[{id:"sat",type:"raster",source:"sat"}]
 },
 center:userLocation,zoom:13,pitch:55,bearing:-17
});

/* USER MARKER */
let userMarker;
function placeUserMarker(){
 if(userMarker) userMarker.remove();
 let pin=document.createElement("div");
 pin.className="user-pin";
 let ring=document.createElement("div");
 ring.className="ring";
 pin.appendChild(ring);
 userMarker=new maplibregl.Marker({element:pin}).setLngLat(userLocation).addTo(map3d);
}
placeUserMarker();

/* MARKERS */
let markers=[];
let hoverLabel=document.createElement("div");
let infoBubble=document.createElement("div");
hoverLabel.className="hover-label";
infoBubble.className="info-bubble";
document.body.appendChild(hoverLabel);
document.body.appendChild(infoBubble);

function addMarkers(arr){
 markers.forEach(m=>m.remove());
 markers=[];
 arr.forEach(e=>{
  let dot=document.createElement("div");
  let col=e.mood==="chill"?"#00e1ff":e.mood==="adrenaline"?"#ff006a":e.mood==="social"?"#ff00f5":"#fff";
  dot.style.cssText=`width:14px;height:14px;border-radius:50%;background:${col};box-shadow:0 0 12px ${col}`;
  let m1=new maplibregl.Marker({element:dot}).setLngLat([e.mapX,e.mapY]).addTo(map3d);
  markers.push(m1);

  let d=hav(userLocation[1],userLocation[0],e.mapY,e.mapX).toFixed(1);

  dot.onclick=()=>openPopup(e,d);

  dot.onmouseenter=ev=>{
   hoverLabel.innerHTML=`${e.title} • ${d} km`;
   hoverLabel.style.left=ev.clientX+"px";
   hoverLabel.style.top=(ev.clientY-26)+"px";
   hoverLabel.classList.add("show");
  };
  dot.onmousemove=ev=>{
   hoverLabel.style.left=ev.clientX+"px";
   hoverLabel.style.top=(ev.clientY-26)+"px";
  };
  dot.onmouseleave=()=>hoverLabel.classList.remove("show");

  let lbl=document.createElement("div");
  lbl.className="distance-label";
  lbl.innerText=`${d} km`;
  let m2=new maplibregl.Marker({element:lbl,anchor:"bottom"}).setLngLat([e.mapX,e.mapY]).addTo(map3d);
  markers.push(m2);

  lbl.onclick=()=>openPopup(e,d);
 });
}

/* POPUP */
let selectedPopupItem=null;

function openPopup(data,d){
 selectedPopupItem=data;
 popupTitle.innerText=data.title;
 popupSub.innerHTML=`${data.city} • ${d} km<br>${data.description}`;
 popupNavBtn.onclick=()=>window.open(`https://www.google.com/maps/dir/?api=1&destination=${data.mapY},${data.mapX}`);
 popupOverlay.style.display="block";
 popupBox.style.display="block";
}

popupOverlay.onclick=()=>{popupOverlay.style.display="none";popupBox.style.display="none"};
popupClose.onclick=()=>{popupOverlay.style.display="none";popupBox.style.display="none"};

/* SAVE ITINERARY */
async function saveToItinerary(item){
 const user=auth.currentUser;
 if(!user){ alert("Please login to save places."); return; }

 const ref=db.collection("users").doc(user.uid).collection("itinerary").doc(String(item.id));
 const snap=await ref.get();

 if(snap.exists){ alert("Already saved ✔"); return; }

 await ref.set({
  id:item.id,title:item.title,city:item.city,description:item.description,
  lat:item.mapY,lng:item.mapX,timestamp:Date.now()
 });

 alert("Added to your itinerary ✔");
}

popupSaveBtn.onclick=()=>{ if(selectedPopupItem) saveToItinerary(selectedPopupItem); };

/* FILTER */
function filterExperiences(){
 let r=parseInt(ratingFilter.value);
 let b=budgetFilter.value;
 let c=crowdFilter.value;
 let dist=parseInt(distanceFilter.value);
 let maxD=dist===20 ? 99999 : dist;

 return experiences.filter(e=>{
  if(currentInterest!=="all" && e.interest!==currentInterest) return false;
  if(currentMood!=="any" && e.mood!==currentMood) return false;
  let d=hav(userLocation[1],userLocation[0],e.mapY,e.mapX);
  return e.rating>=r && d<=maxD && (b==="any"||e.budget===b) && (c==="any"||e.crowd===c);
 });
}

function renderList(arr){
 let box=document.getElementById("experienceList");
 box.innerHTML="";
 arr.forEach(e=>{
  let d=hav(userLocation[1],userLocation[0],e.mapY,e.mapX).toFixed(1);
  box.innerHTML+=`
   <div class="exp-card">
     <div>
       <div class="exp-title">${e.title}</div>
       <div class="exp-city">${e.city} • ${d} km</div>
       <div class="exp-desc">${e.description}</div>
     </div>
     <button class="like-btn" data-heart="${e.id}">
       <svg viewBox="0 0 24 24">
         <path d="M12 21s-6-4.4-9-8.5S3 3 7.5 3 12 7 12 7s2.5-4 6.5-4S24 7 21 12.5 12 21 12 21z"/>
       </svg>
     </button>
   </div>`;
 });

 resultsCount.innerText=`${arr.length} results`;
}

/* UPDATE */
function update(){
 let f=filterExperiences();
 renderList(f);
 addMarkers(f);

 document.querySelectorAll("[data-heart]").forEach(btn=>{
  btn.onclick=()=>{
   const id=parseInt(btn.dataset.heart);
   const item=experiences.find(x=>x.id===id);
   saveToItinerary(item);
   btn.classList.add("saved");
  };
 });
}

/* CLICK EVENTS */
document.querySelectorAll(".chip").forEach(btn=>{
 btn.onclick=()=>{
  document.querySelectorAll(".chip").forEach(c=>c.classList.remove("chip-active"));
  btn.classList.add("chip-active");
  currentInterest=btn.dataset.interest;
  update();
 };
});

document.querySelectorAll(".mood-chip").forEach(m=>{
 m.onclick=()=>{
  document.querySelectorAll(".mood-chip").forEach(x=>x.classList.remove("active"));
  m.classList.add("active");
  currentMood=m.dataset.mood;
  update();
 };
});

ratingFilter.oninput=e=>ratingValue.innerHTML=`★ ${e.target.value}+`;
distanceFilter.oninput=e=>{
 let v=parseInt(e.target.value);
 distanceValue.innerHTML=v===20 ? "20+ km" : `Within ${v} km`;
};

openFilters.onclick=()=>filterPanel.classList.toggle("open");
applyFilters.onclick=()=>{filterPanel.classList.remove("open");update()};

update();
</script>

</body>
</html>
